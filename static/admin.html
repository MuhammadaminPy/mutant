<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Panel ‚Äî TON Games</title>
<style>
/* ‚ïê‚ïê‚ïê ADMIN PANEL STYLES ‚ïê‚ïê‚ïê */
:root {
  --bg:#0d0d1a; --card:#161628; --card2:#1e1e38;
  --gold:#c9a227; --gold-light:#e8cc6a;
  --red:#e84545; --blue:#4a9eff; --green:#3edc81;
  --text:#ddd; --dim:#7a7a9a; --dim2:#5a5a7a;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:20px;}
h1{color:var(--gold-light);font-size:24px;margin-bottom:6px;}
h2{color:var(--gold-light);font-size:18px;margin-bottom:12px;}
h3{color:var(--text);font-size:15px;margin-bottom:8px;}
.subtitle{color:var(--dim);font-size:13px;margin-bottom:20px;}
a{color:var(--blue);text-decoration:none;}
a:hover{text-decoration:underline;}

/* Layout */
.admin-wrap{max-width:960px;margin:0 auto;}
.admin-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px;margin-bottom:24px;}
.stat-box{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(201,162,39,0.12);}
.stat-box-label{font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;}
.stat-box-value{font-size:26px;font-weight:800;color:var(--gold-light);}
.stat-box-sub{font-size:12px;color:var(--dim2);margin-top:4px;}

/* Search */
.search-wrap{display:flex;gap:10px;margin-bottom:20px;}
.search-wrap input{flex:1;background:var(--card2);border:1px solid rgba(201,162,39,0.2);border-radius:10px;padding:10px 14px;color:#fff;font-size:15px;outline:none;}
.search-wrap input:focus{border-color:var(--gold);}
.btn{background:var(--gold);color:#111;border:none;padding:10px 20px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;}
.btn:active{opacity:0.8;}
.btn-sm{padding:5px 12px;font-size:12px;border-radius:8px;}
.btn-outline{background:transparent;color:var(--gold);border:1px solid var(--gold);}
.btn-red{background:var(--red);color:#fff;}
.btn-green{background:var(--green);color:#111;}
.btn-blue{background:var(--blue);color:#fff;}

/* Tables */
.table-wrap{background:var(--card);border-radius:12px;border:1px solid rgba(255,255,255,0.06);overflow:hidden;margin-bottom:20px;}
table{width:100%;border-collapse:collapse;}
th{background:var(--card2);padding:10px 12px;text-align:left;font-size:12px;color:var(--dim);text-transform:uppercase;letter-spacing:0.6px;font-weight:600;}
td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.05);font-size:14px;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(201,162,39,0.04);}
.clickable{cursor:pointer;color:var(--blue);}
.clickable:hover{text-decoration:underline;}

/* User detail panel */
.panel{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.06);margin-bottom:18px;}
.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.user-detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.ud-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.ud-row:last-child{border-bottom:none;}
.ud-label{color:var(--dim);font-size:13px;}
.ud-value{font-weight:600;font-size:13px;}

/* Balance adjust */
.adj-wrap{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.adj-wrap input{background:var(--card2);border:1px solid rgba(201,162,39,0.2);border-radius:8px;padding:7px 10px;color:#fff;font-size:14px;width:100px;outline:none;}

/* Withdrawal actions */
.wd-actions{display:flex;gap:8px;}
.wd-note-input{background:var(--card2);border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:6px 10px;color:#fff;font-size:13px;flex:1;outline:none;}

/* Tabs */
.admin-tabs{display:flex;gap:6px;margin-bottom:18px;}
.admin-tab{background:var(--card2);border:1px solid rgba(255,255,255,0.08);color:var(--dim);border-radius:18px;padding:6px 16px;font-size:13px;cursor:pointer;}
.admin-tab.active{background:var(--gold);color:#111;border-color:var(--gold);font-weight:600;}

/* Toast */
.toast{position:fixed;top:20px;right:20px;background:#222;color:#fff;padding:10px 20px;border-radius:16px;font-size:14px;opacity:0;transform:translateY(-20px);transition:all 0.3s;z-index:999;pointer-events:none;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.ok{background:#2a6a3a;}
.toast.err{background:#6a2a2a;}

/* History */
.history-item{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid rgba(255,255,255,0.04);font-size:13px;}
.history-item:last-child{border-bottom:none;}
.hist-type{color:var(--blue);font-weight:600;}
.hist-win{color:var(--green);font-weight:600;}
.hist-lose{color:var(--red);font-weight:600;}

/* Responsive */
@media(max-width:600px){
  body{padding:12px;}
  .admin-grid{grid-template-columns:repeat(2,1fr);}
  .user-detail-grid{grid-template-columns:1fr;}
  table{font-size:12px;}
  td,th{padding:7px 8px;}
}
</style>
</head>
<body>
<div class="admin-wrap">
  <h1>‚öôÔ∏è Admin Panel</h1>
  <p class="subtitle">TON Games ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>

  <!-- Global Stats -->
  <div class="admin-grid" id="stats-grid">
    <div class="stat-box"><div class="stat-box-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div><div class="stat-box-value" id="s-total">‚Äî</div></div>
    <div class="stat-box"><div class="stat-box-label">–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</div><div class="stat-box-value" id="s-now" style="color:var(--green)">‚Äî</div></div>
    <div class="stat-box"><div class="stat-box-label">–ó–∞ 24 —á–∞—Å–∞</div><div class="stat-box-value" id="s-24h" style="color:var(--blue)">‚Äî</div></div>
    <div class="stat-box"><div class="stat-box-label">–í—Å–µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–æ</div><div class="stat-box-value" id="s-dep">‚Äî</div><div class="stat-box-sub">TON</div></div>
  </div>

  <!-- Admin Tabs -->
  <div class="admin-tabs">
    <button class="admin-tab active" onclick="adminTab('users',this)">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
    <button class="admin-tab" onclick="adminTab('withdrawals',this)">üì§ –í—ã–≤–æ–¥—ã</button>
  </div>

  <!-- Users Tab -->
  <div id="admin-panel-users">
    <div class="search-wrap">
      <input type="text" id="user-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID –∏–ª–∏ –∏–º–µ–Ω–∏..." oninput="searchUsers()"/>
    </div>
    <div class="table-wrap" id="users-table-wrap">
      <table>
        <thead><tr><th>ID</th><th>–ò–º—è</th><th>–ë–∞–ª–∞–Ω—Å</th><th>–ü–æ–ø–æ–ª–Ω–µ–Ω–æ</th><th>–ò–≥—Ä—ã</th><th></th></tr></thead>
        <tbody id="users-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Withdrawals Tab -->
  <div id="admin-panel-withdrawals" style="display:none">
    <h3>‚è≥ –û–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥</h3>
    <div class="table-wrap">
      <table>
        <thead><tr><th>ID –∑–∞—è–≤–∫–∏</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–°—É–º–º–∞</th><th>–ö–æ—à–µ–ª—ë–∫</th><th>–í—Ä–µ–º—è</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr></thead>
        <tbody id="wd-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- User Detail Panel (hidden by default) -->
  <div id="user-detail-panel" style="display:none">
    <div class="panel">
      <div class="panel-header">
        <h2 id="ud-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
        <button class="btn btn-sm btn-outline" onclick="closeUserDetail()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div class="user-detail-grid">
        <div>
          <div class="ud-row"><span class="ud-label">Telegram ID</span><span class="ud-value" id="ud-tid">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">–ò–º—è</span><span class="ud-value" id="ud-name">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">Username</span><span class="ud-value" id="ud-user">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">–ë–∞–ª–∞–Ω—Å</span><span class="ud-value" id="ud-bal">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">–í—Å–µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–æ</span><span class="ud-value" id="ud-dep">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</span><span class="ud-value" id="ud-games">‚Äî</span></div>
        </div>
        <div>
          <div class="ud-row"><span class="ud-label">–†–µ—Ñ. –ø—Ä–æ—Ü–µ–Ω—Ç</span><span class="ud-value" id="ud-refp">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">–†–µ—Ñ. –±–∞–ª–∞–Ω—Å</span><span class="ud-value" id="ud-refb">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span><span class="ud-value" id="ud-created">‚Äî</span></div>
          <div class="ud-row"><span class="ud-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–Ω–ª–∞–π–Ω</span><span class="ud-value" id="ud-online">‚Äî</span></div>
        </div>
      </div>
      <!-- Balance adjust -->
      <div style="margin-top:16px;">
        <h3>üí∞ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞</h3>
        <div class="adj-wrap">
          <input type="number" id="adj-amount" placeholder="–°—É–º–º–∞" step="0.01"/>
          <button class="btn btn-sm btn-green" onclick="adjustBalance('add')">Ôºã –ù–∞—á–∏—Å–ª–∏—Ç—å</button>
          <button class="btn btn-sm btn-red" onclick="adjustBalance('sub')">‚àí –£–±—Ä–∞—Ç—å</button>
        </div>
      </div>
      <!-- Ref percent -->
      <div style="margin-top:14px;">
        <h3>üìä –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç</h3>
        <div class="adj-wrap">
          <input type="number" id="adj-refp" placeholder="%" step="1" value="10"/>
          <button class="btn btn-sm" onclick="adjustRefPercent()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>
    <!-- Referrals -->
    <div class="panel">
      <h3>üîó –†–µ—Ñ–µ—Ä–∞–ª—ã —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
      <div id="ud-refs">‚Äî</div>
    </div>
    <!-- Game History -->
    <div class="panel">
      <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20)</h3>
      <div id="ud-history">‚Äî</div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
const API = window.location.origin;
let _currentUserId = null;

function toast(msg, type='ok') {
  let t = document.getElementById('toast');
  t.textContent = msg; t.className = 'toast ' + type;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ‚îÄ‚îÄ Load Stats ‚îÄ‚îÄ
async function loadStats() {
  try {
    let res = await fetch(API + '/api/admin/stats');
    let d = await res.json();
    document.getElementById('s-total').textContent = d.total_users;
    document.getElementById('s-now').textContent = d.online_now;
    document.getElementById('s-24h').textContent = d.online_24h;
    document.getElementById('s-dep').textContent = d.total_deposited.toFixed(2);
  } catch(e) {
    // Demo fallback
    document.getElementById('s-total').textContent = '142';
    document.getElementById('s-now').textContent = '23';
    document.getElementById('s-24h').textContent = '67';
    document.getElementById('s-dep').textContent = '284.50';
  }
}

// ‚îÄ‚îÄ Admin Tab Switch ‚îÄ‚îÄ
function adminTab(tab, btn) {
  document.querySelectorAll('.admin-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('admin-panel-users').style.display = tab==='users' ? 'block' : 'none';
  document.getElementById('admin-panel-withdrawals').style.display = tab==='withdrawals' ? 'block' : 'none';
  if (tab==='withdrawals') loadPendingWithdrawals();
}

// ‚îÄ‚îÄ Search Users ‚îÄ‚îÄ
let searchTimeout;
async function searchUsers() {
  clearTimeout(searchTimeout);
  let q = document.getElementById('user-search').value.trim();
  searchTimeout = setTimeout(async () => {
    try {
      let res = await fetch(API + '/api/admin/users/search?q=' + encodeURIComponent(q));
      let users = await res.json();
      renderUsersTable(users);
    } catch(e) {
      // Demo data
      renderUsersTable([
        {telegram_id:12345, name:'Demo User', username:'demouser', balance:1.5},
        {telegram_id:67890, name:'Alice', username:'alice_ton', balance:23.4},
      ]);
    }
  }, 400);
}

function renderUsersTable(users) {
  let tbody = document.getElementById('users-tbody');
  if (!users.length) { tbody.innerHTML = '<tr><td colspan="6" style="color:var(--dim);text-align:center;padding:20px;">–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</td></tr>'; return; }
  tbody.innerHTML = users.map(u => `
    <tr>
      <td>${u.telegram_id}</td>
      <td class="clickable" onclick="openUserDetail(${u.telegram_id})">${u.name || 'User'}</td>
      <td style="color:var(--gold-light);font-weight:600">${(u.balance||0).toFixed(4)}</td>
      <td>${(u.total_deposited||0).toFixed(2)}</td>
      <td>${u.games_played||0}</td>
      <td><button class="btn btn-sm btn-outline" onclick="openUserDetail(${u.telegram_id})">–û—Ç–∫—Ä—ã—Ç—å</button></td>
    </tr>
  `).join('');
}

// ‚îÄ‚îÄ User Detail ‚îÄ‚îÄ
async function openUserDetail(tid) {
  _currentUserId = tid;
  try {
    let res = await fetch(API + '/api/admin/user/' + tid);
    let data = await res.json();
    let u = data.user;
    document.getElementById('user-detail-panel').style.display = 'block';
    document.getElementById('ud-title').textContent = u.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    document.getElementById('ud-tid').textContent = u.telegram_id;
    document.getElementById('ud-name').textContent = u.first_name || '‚Äî';
    document.getElementById('ud-user').textContent = u.username || '‚Äî';
    document.getElementById('ud-bal').textContent = u.balance.toFixed(4) + ' TON';
    document.getElementById('ud-dep').textContent = u.total_deposited.toFixed(2) + ' TON';
    document.getElementById('ud-games').textContent = u.games_played;
    document.getElementById('ud-refp').textContent = u.ref_percent + '%';
    document.getElementById('ud-refb').textContent = u.ref_balance.toFixed(4) + ' TON';
    document.getElementById('ud-created').textContent = u.created_at;
    document.getElementById('ud-online').textContent = u.last_online;
    document.getElementById('adj-refp').value = u.ref_percent;

    // Refs
    let refsEl = document.getElementById('ud-refs');
    if (data.referrals.length) {
      refsEl.innerHTML = data.referrals.map(r => `<div style="padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.04);display:flex;justify-content:space-between;font-size:13px;"><span>${r.name||'User'}</span><span style="color:var(--gold-light)">${r.deposited.toFixed(2)} TON</span></div>`).join('');
    } else { refsEl.innerHTML = '<div style="color:var(--dim2);font-size:13px;">–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>'; }

    // History
    let histEl = document.getElementById('ud-history');
    if (data.game_history.length) {
      histEl.innerHTML = data.game_history.map(h => `
        <div class="history-item">
          <span><span class="hist-type">${h.type}</span> ‚Äî —Å—Ç–∞–≤–∫–∞ ${h.stake} TON</span>
          <span>
            <span class="${h.result >= 0 ? 'hist-win' : 'hist-lose'}">${h.result >= 0 ? '+' : ''}${h.result.toFixed(4)}</span>
            <span style="color:var(--dim2);margin-left:8px;font-size:11px;">${h.played_at}</span>
          </span>
        </div>
      `).join('');
    } else { histEl.innerHTML = '<div style="color:var(--dim2);font-size:13px;">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏</div>'; }

    document.getElementById('user-detail-panel').scrollIntoView({behavior:'smooth'});
  } catch(e) {
    // Demo fallback
    document.getElementById('user-detail-panel').style.display = 'block';
    document.getElementById('ud-tid').textContent = tid;
    document.getElementById('ud-name').textContent = 'Demo';
    document.getElementById('ud-bal').textContent = '1.5000 TON';
    document.getElementById('ud-dep').textContent = '10.00 TON';
    document.getElementById('ud-games').textContent = '3';
    document.getElementById('ud-refp').textContent = '10%';
    document.getElementById('ud-refb').textContent = '0.45 TON';
    document.getElementById('ud-created').textContent = '03.02.2026 20:00';
    document.getElementById('ud-online').textContent = '03.02.2026 21:10';
    document.getElementById('ud-refs').innerHTML = '<div style="color:var(--dim2);font-size:13px;">–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>';
    document.getElementById('ud-history').innerHTML = '<div class="history-item"><span><span class="hist-type">gift_upgrade</span> ‚Äî —Å—Ç–∞–≤–∫–∞ 0.1 TON</span><span class="hist-win">+0.03</span></div>';
  }
}

function closeUserDetail() {
  document.getElementById('user-detail-panel').style.display = 'none';
}

// ‚îÄ‚îÄ Balance Adjust ‚îÄ‚îÄ
async function adjustBalance(action) {
  let amt = parseFloat(document.getElementById('adj-amount').value);
  if (!amt || amt <= 0) { toast('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É', 'err'); return; }
  let payload = { telegram_id: _currentUserId };
  payload[action === 'add' ? 'balance_add' : 'balance_add'] = action === 'sub' ? -amt : amt;
  try {
    let res = await fetch(API + '/api/admin/user/update', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    let data = await res.json();
    if (data.success) {
      document.getElementById('ud-bal').textContent = data.new_balance.toFixed(4) + ' TON';
      toast((action==='add'?'–ù–∞—á–∏—Å–ª–µ–Ω–æ':'–£–±—Ä–∞–Ω–æ') + ' ' + amt + ' TON', 'ok');
    }
  } catch(e) { toast('Demo: ' + (action==='add'?'+':'-') + amt + ' TON', 'ok'); }
}

// ‚îÄ‚îÄ Ref Percent ‚îÄ‚îÄ
async function adjustRefPercent() {
  let val = parseFloat(document.getElementById('adj-refp').value);
  if (isNaN(val)) { toast('–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ', 'err'); return; }
  try {
    let res = await fetch(API + '/api/admin/user/update', { method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ telegram_id: _currentUserId, ref_percent: val }) });
    let data = await res.json();
    if (data.success) { document.getElementById('ud-refp').textContent = val + '%'; toast('–†–µ—Ñ. –ø—Ä–æ—Ü–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω', 'ok'); }
  } catch(e) { toast('–û–±–Ω–æ–≤–ª–µ–Ω–æ (demo)', 'ok'); }
}

// ‚îÄ‚îÄ Pending Withdrawals ‚îÄ‚îÄ
async function loadPendingWithdrawals() {
  try {
    let res = await fetch(API + '/api/admin/withdrawals/pending');
    let reqs = await res.json();
    let tbody = document.getElementById('wd-tbody');
    if (!reqs.length) { tbody.innerHTML = '<tr><td colspan="6" style="color:var(--dim);text-align:center;padding:20px;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</td></tr>'; return; }
    tbody.innerHTML = reqs.map(r => `
      <tr>
        <td>${r.id}</td>
        <td>${r.user_name} <span style="color:var(--dim);font-size:11px;">(${r.user_id})</span></td>
        <td style="color:var(--gold-light);font-weight:600">${r.amount} TON</td>
        <td style="font-size:12px;word-break:break-all;max-width:140px;">${r.wallet}</td>
        <td style="font-size:12px;">${r.created_at}</td>
        <td>
          <div class="wd-actions">
            <input class="wd-note-input" id="wd-note-${r.id}" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ..."/>
            <button class="btn btn-sm btn-green" onclick="wdAction(${r.id},'approve')">‚úì</button>
            <button class="btn btn-sm btn-red" onclick="wdAction(${r.id},'reject')">‚úï</button>
          </div>
        </td>
      </tr>
    `).join('');
  } catch(e) {
    document.getElementById('wd-tbody').innerHTML = '<tr><td colspan="6" style="color:var(--dim);text-align:center;padding:20px;">–ù–µ—Ç –∑–∞—è–≤–æ–∫ (demo)</td></tr>';
  }
}

async function wdAction(id, action) {
  let note = document.getElementById('wd-note-' + id)?.value || '';
  try {
    let res = await fetch(API + `/api/admin/withdrawal/${id}/action`, { method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ action, note }) });
    let data = await res.json();
    if (data.success) {
      toast(action === 'approve' ? '‚úì –û–¥–æ–±—Ä–µ–Ω–∞' : '‚úï –û—Ç–∫–ª–æ–Ω–µ–Ω–∞', action === 'approve' ? 'ok' : 'err');
      loadPendingWithdrawals();
    }
  } catch(e) { toast('–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ (demo)', 'ok'); }
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
loadStats();
setInterval(loadStats, 30000); // refresh stats every 30s
searchUsers(); // load initial users
</script>
</body>
</html>
